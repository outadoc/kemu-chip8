import fr.outadoc.kemu.Speed
import fr.outadoc.kemu.array.ubyteArray2Of
import fr.outadoc.kemu.b
import fr.outadoc.kemu.chip8.browser.display.CanvasChip8DisplayDriver
import kotlinx.browser.document
import fr.outadoc.kemu.chip8.Chip8Runner
import fr.outadoc.kemu.chip8.browser.display.createCanvasContext
import fr.outadoc.kemu.chip8.display.Chip8Keypad
import kotlinx.browser.window

fun main() {
    window.onload = {
        val context = createCanvasContext()
        document.body?.appendChild(context.canvas)

        val displayDriver = CanvasChip8DisplayDriver(context)
        val keypad = Chip8Keypad()

        Chip8Runner(keypad, displayDriver).apply {
            speed = Speed.SUPER_SLOW
            execute(testProgram)
        }
    }
}

val testProgram = ubyteArray2Of(
    0x12.b,
    0x4E.b,
    0xEA.b,
    0xAC.b,
    0xAA.b,
    0xEA.b,
    0xCE.b,
    0xAA.b,
    0xAA.b,
    0xAE.b,
    0xE0.b,
    0xA0.b,
    0xA0.b,
    0xE0.b,
    0xC0.b,
    0x40.b,
    0x40.b,
    0xE0.b,
    0xE0.b,
    0x20.b,
    0xC0.b,
    0xE0.b,
    0xE0.b,
    0x60.b,
    0x20.b,
    0xE0.b,
    0xA0.b,
    0xE0.b,
    0x20.b,
    0x20.b,
    0x60.b,
    0x40.b,
    0x20.b,
    0x40.b,
    0xE0.b,
    0x80.b,
    0xE0.b,
    0xE0.b,
    0xE0.b,
    0x20.b,
    0x20.b,
    0x20.b,
    0xE0.b,
    0xE0.b,
    0xA0.b,
    0xE0.b,
    0xE0.b,
    0xE0.b,
    0x20.b,
    0xE0.b,
    0x40.b,
    0xA0.b,
    0xE0.b,
    0xA0.b,
    0xE0.b,
    0xC0.b,
    0x80.b,
    0xE0.b,
    0xE0.b,
    0x80.b,
    0xC0.b,
    0x80.b,
    0xA0.b,
    0x40.b,
    0xA0.b,
    0xA0.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x00.b,
    0xEE.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x13.b,
    0xDC.b,
    0x68.b,
    0x01.b,
    0x69.b,
    0x05.b,
    0x6A.b,
    0x0A.b,
    0x6B.b,
    0x01.b,
    0x65.b,
    0x2A.b,
    0x66.b,
    0x2B.b,
    0xA2.b,
    0x16.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x02.b,
    0x36.b,
    0x2B.b,
    0xA2.b,
    0x06.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x06.b,
    0xA2.b,
    0x1A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x45.b,
    0x2A.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x0B.b,
    0xA2.b,
    0x1E.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x55.b,
    0x60.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x10.b,
    0xA2.b,
    0x26.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x76.b,
    0xFF.b,
    0x46.b,
    0x2A.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x15.b,
    0xA2.b,
    0x2E.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x95.b,
    0x60.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x1A.b,
    0xA2.b,
    0x32.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0x22.b,
    0x42.b,
    0x68.b,
    0x17.b,
    0x69.b,
    0x1B.b,
    0x6A.b,
    0x20.b,
    0x6B.b,
    0x01.b,
    0xA2.b,
    0x0A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x36.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x06.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x0A.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x87.b,
    0x50.b,
    0x47.b,
    0x2A.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x0B.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x0E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x67.b,
    0x2A.b,
    0x87.b,
    0xB1.b,
    0x47.b,
    0x2B.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x10.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x12.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0x78.b,
    0x67.b,
    0x1F.b,
    0x87.b,
    0x62.b,
    0x47.b,
    0x18.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x15.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x16.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0x78.b,
    0x67.b,
    0x1F.b,
    0x87.b,
    0x63.b,
    0x47.b,
    0x67.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x1A.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x1A.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0x8C.b,
    0x67.b,
    0x8C.b,
    0x87.b,
    0x64.b,
    0x47.b,
    0x18.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x68.b,
    0x2C.b,
    0x69.b,
    0x30.b,
    0x6A.b,
    0x34.b,
    0x6B.b,
    0x01.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x1E.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0x8C.b,
    0x67.b,
    0x78.b,
    0x87.b,
    0x65.b,
    0x47.b,
    0xEC.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x06.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x22.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0xE0.b,
    0x86.b,
    0x6E.b,
    0x46.b,
    0xC0.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x0B.b,
    0xA2.b,
    0x2A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x36.b,
    0xD9.b,
    0xB4.b,
    0xA2.b,
    0x06.b,
    0x66.b,
    0x0F.b,
    0x86.b,
    0x66.b,
    0x46.b,
    0x07.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x10.b,
    0xA2.b,
    0x3A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x1E.b,
    0xD9.b,
    0xB4.b,
    0xA3.b,
    0xE8.b,
    0x60.b,
    0x00.b,
    0x61.b,
    0x30.b,
    0xF1.b,
    0x55.b,
    0xA3.b,
    0xE9.b,
    0xF0.b,
    0x65.b,
    0xA2.b,
    0x06.b,
    0x40.b,
    0x30.b,
    0xA2.b,
    0x02.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x15.b,
    0xA2.b,
    0x3A.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x16.b,
    0xD9.b,
    0xB4.b,
    0xA3.b,
    0xE8.b,
    0x66.b,
    0x89.b,
    0xF6.b,
    0x33.b,
    0xF2.b,
    0x65.b,
    0xA2.b,
    0x02.b,
    0x30.b,
    0x01.b,
    0xA2.b,
    0x06.b,
    0x31.b,
    0x03.b,
    0xA2.b,
    0x06.b,
    0x32.b,
    0x07.b,
    0xA2.b,
    0x06.b,
    0xDA.b,
    0xB4.b,
    0x6B.b,
    0x1A.b,
    0xA2.b,
    0x0E.b,
    0xD8.b,
    0xB4.b,
    0xA2.b,
    0x3E.b,
    0xD9.b,
    0xB4.b,
    0x12.b,
    0x48.b,
    0x13.b,
    0xDC.b
)